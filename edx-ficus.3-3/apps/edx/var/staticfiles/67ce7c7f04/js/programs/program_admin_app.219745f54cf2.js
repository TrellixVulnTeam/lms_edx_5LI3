// Backbone.Validation v0.11.5
//
// Copyright (c) 2011-2015 Thomas Pedersen
// Distributed under MIT License
//
// Documentation and full license available at:
// http://thedersen.com/projects/backbone-validation

/*!
 * jQuery Cookie Plugin
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2011, Klaus Hartl
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 */

Backbone.Validation=function(e){"use strict";var t={forceUpdate:!1,selector:"name",labelFormatter:"sentenceCase",valid:Function.prototype,invalid:Function.prototype},n={formatLabel:function(e,n){return l[t.labelFormatter](e,n)},format:function(){var e=Array.prototype.slice.call(arguments),t=e.shift();return t.replace(/\{(\d+)\}/g,function(t,n){return"undefined"!=typeof e[n]?e[n]:t})}},s=function(t,n,i){return n=n||{},i=i||"",e.each(t,function(a,r){t.hasOwnProperty(r)&&(a&&e.isArray(a)?e.forEach(a,function(e,t){s(e,n,i+r+"."+t+"."),n[i+r+"."+t]=e}):a&&"object"==typeof a&&a.constructor===Object&&s(a,n,i+r+"."),n[i+r]=a)}),n},i=function(){var i=function(t,n){return n=n||e.keys(e.result(t,"validation")||{}),e.reduce(n,function(e,t){return e[t]=void 0,e},{})},r=function(t,n){var s=t.attributes;return e.isFunction(s)?s=s(n):e.isString(s)&&e.isFunction(u[s])&&(s=u[s](n)),e.isArray(s)?s:void 0},o=function(t,n){var s=t.validation?e.result(t,"validation")[n]||{}:{};return(e.isFunction(s)||e.isString(s))&&(s={fn:s}),e.isArray(s)||(s=[s]),e.reduce(s,function(t,n){return e.each(e.without(e.keys(n),"msg"),function(e){t.push({fn:d[e],val:n[e],msg:n.msg})}),t},[])},l=function(t,s,i,a){return e.reduce(o(t,s),function(r,o){var l=e.extend({},n,d),u=o.fn.call(l,i,s,o.val,t,a);return u===!1||r===!1?!1:u&&!r?e.result(o,"msg")||u:r},"")},c=function(t,n,s){var i,a={},r=!0,o=e.clone(n);return e.each(s,function(e,n){i=l(t,n,e,o),i&&(a[n]=i,r=!1)}),{invalidAttrs:a,isValid:r}},m=function(t,n){return{preValidate:function(t,n){var s,i=this,a={};return e.isObject(t)?(e.each(t,function(e,t){s=i.preValidate(t,e),s&&(a[t]=s)}),e.isEmpty(a)?void 0:a):l(this,t,n,e.extend({},this.attributes))},isValid:function(i){var a,o,u,d;return i=i||r(n,t),e.isString(i)?o=[i]:e.isArray(i)&&(o=i),o&&(a=s(this.attributes),e.each(this.associatedViews,function(t){e.each(o,function(s){u=l(this,s,a[s],e.extend({},this.attributes)),u?(n.invalid(t,s,u,n.selector),d=d||{},d[s]=u):n.valid(t,s,n.selector)},this)},this)),i===!0&&(d=this.validate()),d&&this.trigger("invalid",this,d,{validationError:d}),o?!d:this.validation?this._isValid:!0},validate:function(a,o){var l=this,u=!a,d=e.extend({},n,o),m=i(l,r(n,t)),p=e.extend({},m,l.attributes,a),g=s(p),h=a?s(a):g,f=c(l,p,e.pick(g,e.keys(m)));return l._isValid=f.isValid,e.each(l.associatedViews,function(t){e.each(m,function(e,n){var s=f.invalidAttrs.hasOwnProperty(n),i=h.hasOwnProperty(n);s||d.valid(t,n,d.selector),s&&(i||u)&&d.invalid(t,n,f.invalidAttrs[n],d.selector)})}),e.defer(function(){l.trigger("validated",l._isValid,l,f.invalidAttrs),l.trigger("validated:"+(l._isValid?"valid":"invalid"),l,f.invalidAttrs)}),!d.forceUpdate&&e.intersection(e.keys(f.invalidAttrs),e.keys(h)).length>0?f.invalidAttrs:void 0}}},p=function(t,n,s){n.associatedViews?n.associatedViews.push(t):n.associatedViews=[t],e.extend(n,m(t,s))},g=function(t,n){n&&t.associatedViews&&t.associatedViews.length>1?t.associatedViews=e.without(t.associatedViews,n):(delete t.validate,delete t.preValidate,delete t.isValid,delete t.associatedViews)},h=function(e){p(this.view,e,this.options)},f=function(e){g(e)};return{version:"0.11.3",configure:function(n){e.extend(t,n)},bind:function(n,s){s=e.extend({},t,a,s);var i=s.model||n.model,r=s.collection||n.collection;if("undefined"==typeof i&&"undefined"==typeof r)throw"Before you execute the binding your view must have a model or a collection.\nSee http://thedersen.com/projects/backbone-validation/#using-form-model-validation for more information.";i?p(n,i,s):r&&(r.each(function(e){p(n,e,s)}),r.bind("add",h,{view:n,options:s}),r.bind("remove",f))},unbind:function(t,n){n=e.extend({},n);var s=n.model||t.model,i=n.collection||t.collection;s?g(s,t):i&&(i.each(function(e){g(e,t)}),i.unbind("add",h),i.unbind("remove",f))},mixin:m(null,t)}}(),a=i.callbacks={valid:function(e,t,n){e.$("["+n+'~="'+t+'"]').removeClass("invalid").removeAttr("data-error")},invalid:function(e,t,n,s){e.$("["+s+'~="'+t+'"]').addClass("invalid").attr("data-error",n)}},r=i.patterns={digits:/^\d+$/,number:/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,url:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i},o=i.messages={required:"{0} is required",acceptance:"{0} must be accepted",min:"{0} must be greater than or equal to {1}",max:"{0} must be less than or equal to {1}",range:"{0} must be between {1} and {2}",length:"{0} must be {1} characters",minLength:"{0} must be at least {1} characters",maxLength:"{0} must be at most {1} characters",rangeLength:"{0} must be between {1} and {2} characters",oneOf:"{0} must be one of: {1}",equalTo:"{0} must be the same as {1}",digits:"{0} must only contain digits",number:"{0} must be a number",email:"{0} must be a valid email",url:"{0} must be a valid url",inlinePattern:"{0} is invalid"},l=i.labelFormatters={none:function(e){return e},sentenceCase:function(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0===t?e.toUpperCase():" "+e.toLowerCase()}).replace(/_/g," ")},label:function(e,t){return t.labels&&t.labels[e]||l.sentenceCase(e,t)}},u=i.attributeLoaders={inputNames:function(e){var t=[];return e&&e.$("form [name]").each(function(){/^(?:input|select|textarea)$/i.test(this.nodeName)&&this.name&&"submit"!==this.type&&-1===t.indexOf(this.name)&&t.push(this.name)}),t}},d=i.validators=function(){var t=String.prototype.trim?function(e){return null===e?"":String.prototype.trim.call(e)}:function(e){var t=/^\s+/,n=/\s+$/;return null===e?"":e.toString().replace(t,"").replace(n,"")},n=function(t){return e.isNumber(t)||e.isString(t)&&t.match(r.number)},s=function(n){return!(e.isNull(n)||e.isUndefined(n)||e.isString(n)&&""===t(n)||e.isArray(n)&&e.isEmpty(n))};return{fn:function(t,n,s,i,a){return e.isString(s)&&(s=i[s]),s.call(i,t,n,a)},required:function(t,n,i,a,r){var l=e.isFunction(i)?i.call(a,t,n,r):i;return l||s(t)?l&&!s(t)?this.format(o.required,this.formatLabel(n,a)):void 0:!1},acceptance:function(t,n,s,i){return"true"===t||e.isBoolean(t)&&t!==!1?void 0:this.format(o.acceptance,this.formatLabel(n,i))},min:function(e,t,s,i){return!n(e)||s>e?this.format(o.min,this.formatLabel(t,i),s):void 0},max:function(e,t,s,i){return!n(e)||e>s?this.format(o.max,this.formatLabel(t,i),s):void 0},range:function(e,t,s,i){return!n(e)||e<s[0]||e>s[1]?this.format(o.range,this.formatLabel(t,i),s[0],s[1]):void 0},length:function(t,n,s,i){return e.isString(t)&&t.length===s?void 0:this.format(o.length,this.formatLabel(n,i),s)},minLength:function(t,n,s,i){return!e.isString(t)||t.length<s?this.format(o.minLength,this.formatLabel(n,i),s):void 0},maxLength:function(t,n,s,i){return!e.isString(t)||t.length>s?this.format(o.maxLength,this.formatLabel(n,i),s):void 0},rangeLength:function(t,n,s,i){return!e.isString(t)||t.length<s[0]||t.length>s[1]?this.format(o.rangeLength,this.formatLabel(n,i),s[0],s[1]):void 0},oneOf:function(t,n,s,i){return e.include(s,t)?void 0:this.format(o.oneOf,this.formatLabel(n,i),s.join(", "))},equalTo:function(e,t,n,s,i){return e!==i[n]?this.format(o.equalTo,this.formatLabel(t,s),this.formatLabel(n,s)):void 0},pattern:function(e,t,n,i){return s(e)&&e.toString().match(r[n]||n)?void 0:this.format(o[n]||o.inlinePattern,this.formatLabel(t,i),n)}}}();return e.each(d,function(t,s){d[s]=e.bind(d[s],e.extend({},n,d))}),i}(_),define("backbone.validation",function(){}),define("js/programs/models/api_config_model",["backbone"],function(e){"use strict";return e.Model.extend({defaults:{username:"",lmsBaseUrl:"",programsApiUrl:"",authUrl:"/programs/id_token/",idToken:""}})}),define("js/programs/utils/api_config",["js/programs/models/api_config_model"],function(e){"use strict";var t;return void 0===t&&(t=new e),t}),define("js/programs/utils/auth_utils",["jquery","underscore","js/programs/utils/api_config"],function(e,t,n){"use strict";var s={autoSync:{sync:function(e,t,n){var s=n.error;return this._setHeaders(n),n.notifyOnError=!1,n.error=function(i,a,r){i&&401===i.status?this._updateToken(function(){n.error=s,n.notifyOnError=!0,delete n.xhr,this._setHeaders(n),Backbone.sync.call(this,e,t,n)}.bind(this)):s&&s.call(this,i,a,r)}.bind(this),Backbone.sync.call(this,e,t,n)},_setHeaders:function(e){e.headers=t.extend(e.headers||{},{Authorization:"JWT "+n.get("idToken")}),e.xhrFields=t.extend(e.xhrFields||{},{withCredentials:!0})},_updateToken:function(t){e.ajax({url:n.get("authUrl"),xhrFields:{withCredentials:!0},crossDomain:!0}).done(function(e){n.set("idToken",e.id_token)}).done(t)}}};return s}),define("js/programs/models/auto_auth_model",["backbone","js/programs/utils/auth_utils"],function(e,t){"use strict";return e.Model.extend(t.autoSync)}),define("js/programs/models/organizations_model",["js/programs/utils/api_config","js/programs/models/auto_auth_model"],function(e,t){"use strict";return t.extend({url:function(){return e.get("programsApiUrl")+"organizations/?page_size=1000"}})}),function(e){e.cookie=function(t,n,s){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(n))||null===n||void 0===n)){if(s=e.extend({},s),(null===n||void 0===n)&&(s.expires=-1),"number"==typeof s.expires){var i=s.expires,a=s.expires=new Date;a.setDate(a.getDate()+i)}return n=String(n),document.cookie=[encodeURIComponent(t),"=",s.raw?n:encodeURIComponent(n),s.expires?"; expires="+s.expires.toUTCString():"",s.path?"; path="+s.path:"",s.domain?"; domain="+s.domain:"",s.secure?"; secure":""].join("")}s=n||{};for(var r,o=s.raw?function(e){return e}:decodeURIComponent,l=document.cookie.split("; "),u=0;r=l[u]&&l[u].split("=");u++)if(o(r[0])===t)return o(r[1]||"");return null}}(jQuery),define("jquery.cookie",["jquery"],function(e){return function(){var t;return t||e.jQuery.fn.cookie}}(this)),define("js/programs/models/program_model",["backbone","jquery","js/programs/utils/api_config","js/programs/models/auto_auth_model","gettext","jquery.cookie"],function(e,t,n,s,i){"use strict";return s.extend({validation:{name:{required:!0,maxLength:255},subtitle:{maxLength:255},category:{required:!0,oneOf:["XSeries","MicroMasters"]},organizations:"validateOrganizations",marketing_slug:{maxLength:255}},initialize:function(){this.url=n.get("programsApiUrl")+"programs/"+this.id+"/"},validateOrganizations:function(e){var t,n=e?e.length:0;for(t=0;n>t;t++)if("false"===e[t].key)return i("Please select a valid organization.")},getConfig:function(e){var t=e&&e.patch,s=t?this.get("id")+"/":"",i=_.extend({validate:!0,parse:!0},{type:t?"PATCH":"POST",url:n.get("programsApiUrl")+"programs/"+s,contentType:t?"application/merge-patch+json":"application/json",context:this,success:_.bind(this.saveSuccess,this),error:_.bind(this.saveError,this)});return t&&(i.data=JSON.stringify(e.update)||this.attributes),i},patch:function(e){this.save({patch:!0,update:e})},save:function(e){var t,n=e&&e.patch?!0:!1,s=this.getConfig(e);t=this.isNew()?"create":n?"patch":"update",this.sync(t,this,s)},saveError:function(e){this.trigger("error",e)},saveSuccess:function(e){this.set({id:e.id}),this.trigger("sync",this)}})}),define("text",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),define("text!templates/programs/program_creator_form.underscore",[],function(){return'<h3 class="hd-3 emphasized"><%- gettext(\'Create a New Program\') %></h3>\n<form class="form">\n    <fieldset class="form-group bg-white">\n        <div class="field">\n            <label class="field-label" for="program-type"><%- gettext(\'Program type\') %></label>\n            <select id="program-type" class="field-input input-select program-type" name="category">\n                <option value=""><%- gettext(\'Select a type\') %></option>\n                <option value="XSeries"><%- gettext(\'XSeries\') %></option>\n                <option value="MicroMasters"><%- gettext(\'MicroMasters\') %></option>\n            </select>\n            <div class="field-message">\n                <span class="field-message-content"></span>\n            </div>\n        </div>\n\n        <div class="field">\n            <label class="field-label" for="program-org"><%- gettext(\'Organization\') %></label>\n            <select id="program-org" class="field-input input-select program-org" name="organizations">\n                <option value="false"><%- gettext(\'Select an organization\') %></option>\n              <% _.each( orgs, function( org ) { %>\n                <option value="<%- org.key %>"><%- org.display_name %></option>\n              <% }); %>\n            </select>\n            <div class="field-message">\n                <span class="field-message-content"></span>\n            </div>\n        </div>\n\n        <div class="field">\n            <label class="field-label" for="program-name"><%- gettext(\'Name\') %></label>\n            <input id="program-name" class="field-input input-text program-name" name="name" maxlength="64" aria-describedby="program-name-desc" required>\n            <div class="field-message">\n                <span class="field-message-content"></span>\n            </div>\n            <div class="field-hint" id="program-name-desc">\n                <p><%- gettext(\'The public display name of the program.\') %></p>\n            </div>\n        </div>\n\n        <div class="field">\n            <label class="field-label" for="program-subtitle"><%- gettext(\'Subtitle\') %></label>\n            <input id="program-subtitle" class="field-input input-text program-subtitle" name="subtitle" maxlength="255" aria-describedby="program-subtitle-desc">\n            <div class="field-message">\n                <span class="field-message-content"></span>\n            </div>\n            <div class="field-hint" id="program-subtitle-desc">\n                <p><%- gettext(\'A short description of the program, including concepts covered and expected outcomes (255 character limit).\') %></p>\n            </div>\n        </div>\n\n        <div class="field">\n            <label class="field-label" for="program-marketing-slug"><%- gettext(\'Marketing Slug\') %></label>\n            <input id="program-marketing-slug" class="field-input input-text program-marketing-slug" name="marketing_slug" maxlength="255" aria-describedby="program-marketing-slug-desc">\n            <div class="field-message">\n                <span class="field-message-content"></span>\n            </div>\n            <div class="field-hint" id="program-marketing-slug-desc">\n                <p><%- gettext(\'Slug used to generate links to the marketing site.\') %></p>\n            </div>\n        </div>\n\n        <div class="field">\n            <button class="btn btn-brand btn-base js-create-program"><%- gettext(\'Create\') %></button>\n            <button class="btn btn-neutral btn-base js-abort-view"><%- gettext(\'Cancel\') %></button>\n        </div>\n    </fieldset>\n</form>\n'}),define("js/programs/utils/validation_config",["backbone","backbone.validation","underscore","gettext"],function(e,t,n,s){"use strict";var i="has-error",a=".field-message",r=".field-message-content";n.extend(e.Validation.messages,{required:s("{0} is required"),acceptance:s("{0} must be accepted"),min:s("{0} must be greater than or equal to {1}"),max:s("{0} must be less than or equal to {1}"),range:s("{0} must be between {1} and {2}"),length:s("{0} must be {1} characters"),minLength:s("{0} must be at least {1} characters"),maxLength:s("{0} must be at most {1} characters"),rangeLength:s("{0} must be between {1} and {2} characters"),oneOf:s("{0} must be one of: {1}"),equalTo:s("{0} must be the same as {1}"),digits:s("{0} must only contain digits"),number:s("{0} must be a number"),email:s("{0} must be a valid email"),url:s("{0} must be a valid url"),inlinePattern:s("{0} is invalid")}),n.extend(e.Validation.callbacks,{valid:function(e,t,n){var s=e.$("["+n+'~="'+t+'"]'),o=s.siblings(a);s.removeClass(i).removeAttr("data-error"),o.removeClass(i).find(r).text("")},invalid:function(e,t,n,s){var o=e.$("["+s+'~="'+t+'"]'),l=o.siblings(a);o.addClass(i).attr("data-error",n),l.addClass(i).find(r).text(o.data("error"))}}),e.Validation.configure({labelFormatter:"label"})}),define("js/programs/views/program_creator_view",["backbone","backbone.validation","jquery","underscore","js/programs/models/organizations_model","js/programs/models/program_model","text!templates/programs/program_creator_form.underscore","edx-ui-toolkit/js/utils/html-utils","gettext","js/programs/utils/validation_config"],function(e,t,n,s,i,a,r,o){"use strict";return e.View.extend({parentEl:".js-program-admin",events:{"click .js-create-program":"createProgram","click .js-abort-view":"abort"},tpl:o.template(r),initialize:function(t){this.$parentEl=n(this.parentEl),this.model=new a,this.model.on("sync",this.saveSuccess,this),this.model.on("error",this.saveError,this),e.Validation.bind(this),this.organizations=new i,this.organizations.on("sync",this.render,this),this.organizations.fetch(),this.router=t.router},render:function(){o.setHtml(this.$el,this.tpl({orgs:this.organizations.get("results")})),o.setHtml(this.$parentEl,o.HTML(this.$el))},abort:function(e){e.preventDefault(),this.router.goHome()},createProgram:function(e){var t=this.getData();e.preventDefault(),this.model.set(t),this.model.isValid(!0)&&this.model.save()},destroy:function(){e.Validation.unbind(this),this.undelegateEvents(),this.remove()},getData:function(){return{name:this.$el.find(".program-name").val(),subtitle:this.$el.find(".program-subtitle").val(),category:this.$el.find(".program-type").val(),marketing_slug:this.$el.find(".program-marketing-slug").val(),organizations:[{key:this.$el.find(".program-org").val()}]}},goToView:function(t){e.history.navigate(t,{trigger:!0}),this.destroy()},saveError:function(e){console.log("saveError: ",e)},saveSuccess:function(){this.goToView(String(this.model.get("id")))}})}),define("js/programs/collections/course_runs_collection",["backbone","jquery","js/programs/utils/api_config","jquery.cookie"],function(e,t,n){"use strict";return e.Collection.extend({allRuns:[],initialize:function(e,t){var s=t.organization.key,i="?org="+s+"&page_size=1000";this.url=n.get("lmsBaseUrl")+"api/courses/v1/courses/"+i},create:function(e,t){return t=t?_.clone(t):{},e=this._prepareModel(e,t),e?(this.add(e,t),e):void 0},parse:function(e){return this.allRuns=e.results,e.results},addRun:function(e){var t=_.findWhere(this.allRuns,{id:e});this.create(t)},removeRun:function(e){var t=this.where({id:e});this.remove(t)}})}),define("js/programs/utils/constants",[],function(){"use strict";return{keyCodes:{tab:9,enter:13,esc:27,up:38,down:40}}}),define("text!templates/programs/confirm_modal.underscore",[],function(){return'<div class="wrapper wrapper-modal-window wrapper-modal-window-<%- name %>"\n     aria-describedby="modal-window-description"\n     aria-labelledby="modal-window-title"\n     aria-hidden=""\n     role="dialog">\n    <div class="modal-window-overlay"></div>\n    <div class="js-focus-first modal-window modal-medium modal-type-confirm" tabindex="-1" aria-labelledby="modal-window-title">\n        <div class="<%- name %>-modal">\n            <div class="modal-content">\n                <span class="copy copy-lead emphasized"><%- title %></span>\n                <p class="copy copy-base"><%- body %></p>\n            </div>\n            <div class="modal-actions">\n                <h3 class="sr-only"><%- gettext(\'Actions\') %></h3>\n                <button class="js-confirm btn btn-brand btn-base">\n                    <span><%- cta.confirm %></span>\n                </button>\n                <button class="js-cancel btn btn-neutral btn-base">\n                    <span><%- cta.cancel %></span>\n                </button>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("js/programs/views/confirm_modal_view",["backbone","jquery","underscore","js/programs/utils/constants","text!templates/programs/confirm_modal.underscore","edx-ui-toolkit/js/utils/html-utils","gettext"],function(e,t,n,s,i,a){"use strict";return e.View.extend({events:{"click .js-cancel":"destroy","click .js-confirm":"confirm",keydown:"handleKeydown"},tpl:a.template(i),initialize:function(e){this.$parentEl=t(e.parentEl),this.callback=e.callback,this.content=e.content,this.render()},render:function(){a.setHtml(this.$el,this.tpl(this.content)),a.setHtml(this.$parentEl,a.HTML(this.$el)),this.postRender()},postRender:function(){this.$el.find(".js-focus-first").focus()},confirm:function(){this.callback(),this.destroy()},destroy:function(){this.undelegateEvents(),this.remove(),this.$parentEl.html("")},handleKeydown:function(e){var t=e.keyCode;t===s.keyCodes.esc&&this.destroy()}})}),define("js/programs/models/course_model",["backbone","jquery","js/programs/utils/api_config","js/programs/models/auto_auth_model","jquery.cookie","gettext"],function(e,t,n,s){"use strict";return s.extend({validation:{key:{required:!0,maxLength:64},display_name:{required:!0,maxLength:128}},labels:{key:gettext("Course Code"),display_name:gettext("Course Title")},defaults:{display_name:!1,key:!1,organization:[],run_modes:[]}})}),define("js/programs/models/course_run_model",["backbone"],function(e){"use strict";return e.Model.extend({defaults:{course_key:"",mode_slug:"verified",sku:"",start_date:"",run_key:""}})}),define("text!templates/programs/course_run.underscore",[],function(){return'<div class="card run-container">\n  <% if ( !_.isUndefined(course_key) ) { %>\n    <span class="copy copy-large emphasized"><%- interpolate(\n        gettext(\'Run %(key)s\'),\n        { key: course_key },\n        true\n    ) %></span>\n    <% if ( programStatus === \'unpublished\' ) { %>\n        <button class="js-remove-run btn btn-delete right" data-tooltip="<%- gettext(\'Delete course run\') %>">\n            <span class="icon fa fa-trash-o" aria-hidden="true"></span>\n            <span class="sr-only"><%- interpolate(\n                gettext(\'Remove run %(key)s from the program\'),\n                { key: course_key },\n                true\n            ) %></span>\n        </button>\n    <% } %>\n    <div class="copy copy-base subtitle"><%- interpolate(\n        gettext(\'Start Date: %(date)s\'),\n        { date: start_date },\n        true\n    ) %></div>\n    <div class="copy copy-base subtitle"><%- interpolate(\n        gettext(\'Mode: %(mode)s\'),\n        { mode: mode_slug },\n        true\n    ) %></div>\n  <% } else { %>\n    <select class="js-course-run-select">\n        <option><%- gettext(\'Please select a Course Run\') %></option>\n        <% _.each(courseRuns, function(run) { %>\n            <option value="<%- run.id %>"><%- run.name %>: <%- run.id %></option>\n        <% }); %>\n    </select>\n  <% } %>\n</div>\n'}),define("js/programs/views/course_run_view",["backbone","jquery","underscore","text!templates/programs/course_run.underscore","edx-ui-toolkit/js/utils/html-utils"],function(e,t,n,s,i){"use strict";return e.View.extend({events:{"change .js-course-run-select":"selectRun","click .js-remove-run":"removeRun"},tpl:i.template(s),initialize:function(e){this.courseModel=e.courseModel,this.courseRuns=e.courseRuns,this.programStatus=e.programStatus,this.model.on("change",this.render,this),this.courseRuns.on("update",this.updateDropdown,this),this.$parentEl=e.$parentEl,this.render()},render:function(){var e=this.model.attributes;e.programStatus=this.programStatus,this.courseRuns&&(e.courseRuns=this.courseRuns.toJSON()),i.setHtml(this.$el,this.tpl(e)),this.$parentEl.append(this.$el)},destroy:function(){this.undelegateEvents(),this.remove()},formatData:function(e){return{course_key:e.id,mode_slug:"verified",start_date:e.start,sku:""}},removeRun:function(){var e=this.model.get("start_date"),t=this.model.get("course_key"),s=n.clone(this.courseModel.get("run_modes")),i=[];i=n.reject(s,function(n){return n.start_date===e&&n.course_key===t}),this.courseModel.set({run_modes:i}),this.courseRuns.addRun(t),this.destroy()},selectRun:function(e){var s=t(e.currentTarget).val(),i=n.findWhere(this.courseRuns.allRuns,{id:s}),a=n.clone(this.courseModel.get("run_modes")),r=this.formatData(i);this.model.set(r),a.push(r),this.courseModel.set({run_modes:a}),this.courseRuns.removeRun(s)},updateDropdown:function(){this.model.get("course_key")||this.render()}})}),define("text!templates/programs/course_details.underscore",[],function(){return'<div class="card course-container">\n<% if ( display_name ) {  %>\n    <span class="copy copy-large emphasized"><%- display_name %></span>\n  <% if ( status === \'unpublished\' ) { %>\n    <button class="js-remove-course btn btn-delete right" data-tooltip="<%- gettext(\'Delete course\') %>">\n        <span class="icon fa fa-trash-o" aria-hidden="true"></span>\n        <span class="sr-only"><%- interpolate(\n            gettext(\'Remove %(name)s from the program\'),\n            { name: display_name },\n            true\n        ) %></span>\n    </button>\n  <% } %>\n    <p class="copy copy-base subtitle"><%- organization.display_name %> / <%- key %>\n    <div class="js-course-runs"></div>\n  <% if ( courseRuns.length > -1 ) { %>\n    <button class="js-add-course-run btn btn-neutral btn-base full">\n        <span class="icon fa fa-plus" aria-hidden="true"></span>\n        <span class="text"><%- gettext(\'Add another run\') %></span>\n    </button>\n  <% } %>\n<% } else { %>\n    <form class="form js-course-form">\n        <fieldset class="form-group">\n            <div class="field">\n                <label class="field-label" for="course-key-<%- cid %>"><%- gettext(\'Course Code\') %></label>\n                <input id="course-key-<%- cid %>" class="field-input input-text course-key" name="key" aria-describedby="course-key-<%- cid %>-desc" maxlength="255" required>\n                <div class="field-message">\n                    <span class="field-message-content"></span>\n                </div>\n                <div class="field-hint" id="course-key-<%- cid %>-desc">\n                    <p><%- gettext(\'The unique number that identifies your course within your organization, e.g. CS101.\') %></p>\n                </div>\n            </div>\n            <div class="field">\n                <label class="field-label" for="display-name-<%- cid %>"><%- gettext(\'Course Title\') %></label>\n                <input id="display-name-<%- cid %>" class="field-input input-text display-name" name="display_name" aria-describedby="display-name-<%- cid %>-desc" maxlength="255" required>\n                <div class="field-message">\n                    <span class="field-message-content"></span>\n                </div>\n                <div class="field-hint" id="display-name-<%- cid %>-desc">\n                    <p><%- gettext(\'The title entered here will override the title set for the individual run of the course. It will be displayed on the XSeries progress page and in marketing presentations.\') %></p>\n                </div>\n            </div>\n            <button class="btn btn-primary js-select-course"><%- gettext(\'Save Course\') %></button>\n        </fieldset>\n    </form>\n<% } %>\n</div>\n'}),define("js/programs/views/course_details_view",["backbone","backbone.validation","jquery","underscore","js/programs/models/course_model","js/programs/models/course_run_model","js/programs/models/program_model","js/programs/views/course_run_view","text!templates/programs/course_details.underscore","edx-ui-toolkit/js/utils/html-utils","gettext","js/programs/utils/validation_config"],function(e,t,n,s,i,a,r,o,l,u){"use strict";return e.View.extend({parentEl:".js-course-list",className:"course-details",events:{"click .js-remove-course":"destroy","click .js-select-course":"setCourse","click .js-add-course-run":"addCourseRun"},tpl:u.template(l),initialize:function(t){this.model=new i,e.Validation.bind(this),this.$parentEl=n(this.parentEl),this.courseRunViews=[],this.courseRuns=t.courseRuns,this.programModel=t.programModel,t.courseData?this.model.set(t.courseData):this.model.set({run_modes:[]}),this.model.set({cid:this.model.cid}),this.model.on("change:run_modes",this.updateRuns,this),this.render()},render:function(){u.setHtml(this.$el,this.tpl(this.formatData())),this.$parentEl.append(this.$el),this.postRender()},postRender:function(){var e=this.model.get("run_modes");e&&e.length>0&&this.addCourseRuns()},addCourseRun:function(e){var t,n=this.$el.find(".js-course-runs"),s=new a;e.preventDefault(),s.set({course_key:void 0}),t=new o({model:s,courseModel:this.model,courseRuns:this.courseRuns,programStatus:this.programModel.get("status"),$parentEl:n}),this.courseRunViews.push(t)},addCourseRuns:function(){var e=this.model.get("run_modes"),t=this.$el.find(".js-course-runs");s.each(e,function(e){var n,s=new a;return s.set(e),n=new o({model:s,courseModel:this.model,courseRuns:this.courseRuns,programStatus:this.programModel.get("status"),$parentEl:t}),this.courseRunViews.push(n),n}.bind(this))},addCourseToProgram:function(){var e=this.programModel.get("course_codes"),t=this.model.toJSON();this.programModel.isValid(!0)&&(e.push(s.omit(t,"cid")),this.programModel.patch({course_codes:e}))},destroy:function(){e.Validation.unbind(this),this.destroyChildren(),this.undelegateEvents(),this.removeCourseFromProgram(),this.remove()},destroyChildren:function(){var e=this.courseRunViews;s.each(e,function(e){e.removeRun()})},formatData:function(){var e=n.extend({},{courseRuns:this.courseRuns.models},s.omit(this.programModel.toJSON(),"run_modes"),this.model.toJSON());return e},removeCourseFromProgram:function(){var e=this.programModel.get("course_codes"),t=this.model.get("key"),n=this.model.get("display_name"),i=[];i=s.reject(e,function(e){return e.key===t&&e.display_name===n}),this.programModel.patch({course_codes:i})},setCourse:function(e){var t=this.$(".js-course-form"),n=t.find(".display-name").val(),s=t.find(".course-key").val();e.preventDefault(),this.model.set({display_name:n,key:s,organization:this.programModel.get("organizations")[0]}),this.model.isValid(!0)&&(this.addCourseToProgram(),this.updateDOM(),this.addCourseRuns())},updateDOM:function(){u.setHtml(this.$el,this.tpl(this.formatData()));
},updateRuns:function(){var e,t=this.programModel.get("course_codes"),n=this.model.get("key"),i=this.model.get("display_name");this.programModel.isValid(!0)&&(e=s.findIndex(t,function(e){return e.key===n&&e.display_name===i}),t[e]=this.model.toJSON(),this.programModel.patch({course_codes:t}))}})}),define("text!templates/programs/program_details.underscore",[],function(){return'<header class="app-header">\n    <form class="layout layout-1q3q">\n        <div class="layout-col layout-col-b">\n            <div class="js-inline-edit field">\n                <span class="js-model-value copy copy-large emphasized"><%- name %></span>\n                <label for="program-name" class="sr-only"><%- gettext(\'Name\') %></label>\n                <input type="text" value="<%- name %>" id="program-name" class="program-name field-input is-hidden" name="name" data-field="name" maxlength="64" required>\n                <button class="js-enable-edit btn btn-edit" data-tooltip="<%- gettext(\'Edit the program title\') %>">\n                    <span class="icon fa fa-pencil" aria-hidden="true"></span>\n                    <span class="sr-only"><%- gettext(\'Edit the program\\\'s name.\') %></span>\n                </button>\n                <div class="field-message">\n                    <span class="field-message-content"></span>\n                </div>\n            </div>\n\n            <div class="js-inline-edit field">\n                <span class="js-model-value copy copy-base subtitle"><%- subtitle %></span>\n                <label for="program-subtitle" class="sr-only"><%- gettext(\'Subtitle\') %></label>\n                <input type="text" value="<%- subtitle %>" id="program-subtitle" class="program-subtitle field-input is-hidden" name="subtitle" data-field="subtitle" maxlength="255">\n                <button class="js-enable-edit btn btn-edit" data-tooltip="<%- gettext(\'Edit the program subtitle\') %>">\n                    <span class="icon fa fa-pencil" aria-hidden="true"></span>\n                    <span class="sr-only"><%- gettext(\'Edit the program\\\'s subtitle.\') %></span>\n                </button>\n                <div class="field-message">\n                    <span class="field-message-content"></span>\n                </div>\n            </div>\n\n            <div class="js-inline-edit field">\n                <span class="js-model-value copy copy-base subtitle"><%- marketing_slug %></span>\n                <label for="program-subtitle" class="sr-only"><%- gettext(\'Marketing Slug\') %></label>\n                <input type="text" value="<%- marketing_slug %>" id="program-marketing-slug" class="program-marketing-slug field-input is-hidden" name="marketing_slug" data-field="marketing_slug" maxlength="255">\n                <button class="js-enable-edit btn btn-edit" data-tooltip="<%- gettext(\'Edit the program marketing slug\') %>">\n                    <span class="icon fa fa-pencil" aria-hidden="true"></span>\n                    <span class="sr-only"><%- gettext(\'Edit the program\\\'s marketing slug.\') %></span>\n                </button>\n                <div class="field-message">\n                    <span class="field-message-content"></span>\n                </div>\n            </div>\n        </div>\n\n        <div class="layout-col layout-col-a">\n          <% if ( status === \'unpublished\' ) { %>\n            <button class="js-publish-program btn btn-neutral btn-base btn-grey right">\n                <span><%- gettext(\'Publish\') %></span>\n            </button>\n          <% } %>\n        </div>\n    </form>\n</header>\n<div class="layout-col layout-col-b">\n    <div class="js-course-list"></div>\n  <% if ( status === \'unpublished\' ) { %>\n    <button class="js-add-course btn btn-neutral btn-base full">\n        <span class="icon fa fa-plus" aria-hidden="true"></span>\n        <span class="text"><%- gettext(\'Add a course\') %></span>\n    </button>\n  <% } %>\n</div>\n<aside class="js-aside layout-col layout-col-a"></aside>\n<div class="js-publish-modal"></div>\n'}),define("js/programs/views/program_details_view",["backbone","backbone.validation","jquery","underscore","js/programs/collections/course_runs_collection","js/programs/models/program_model","js/programs/views/confirm_modal_view","js/programs/views/course_details_view","text!templates/programs/program_details.underscore","edx-ui-toolkit/js/utils/html-utils","gettext","js/programs/utils/validation_config"],function(e,t,n,s,i,a,r,o,l,u){"use strict";return e.View.extend({el:".js-program-admin",events:{"blur .js-inline-edit input":"checkEdit","click .js-add-course":"addCourse","click .js-enable-edit":"editField","click .js-publish-program":"confirmPublish"},tpl:u.template(l),initialize:function(){e.Validation.bind(this),this.courseRuns=new i([],{organization:this.model.get("organizations")[0]}),this.courseRuns.fetch(),this.courseRuns.on("sync",this.setAvailableCourseRuns,this),this.render()},render:function(){u.setHtml(this.$el,this.tpl(this.model.toJSON())),this.postRender()},postRender:function(){var e=this.model.get("course_codes");s.each(e,function(e){var t=e.key+"Course";this[t]=new o({courseRuns:this.courseRuns,programModel:this.model,courseData:e})}.bind(this)),this.model.off("sync")},addCourse:function(){return new o({courseRuns:this.courseRuns,programModel:this.model})},checkEdit:function(e){var t=n(e.target),s=t.prevAll(".js-model-value"),i=t.next(".js-enable-edit"),a=t.val(),r=t.data("field"),o={};o[r]=a,t.addClass("is-hidden"),i.removeClass("is-hidden"),s.removeClass("is-hidden"),this.model.get(r)!==a&&(this.model.set(o),this.model.isValid(!0)&&(this.model.patch(o),s.text(a)))},confirmPublish:function(e){e.preventDefault(),this.model.isValid(!0)&&this.validateMarketingSlug()&&(this.modalView=new r({model:this.model,callback:s.bind(this.publishProgram,this),content:this.getModalContent(),parentEl:".js-publish-modal",parentView:this}))},editField:function(e){var t=n(e.currentTarget),s=t.prev("input");e.preventDefault(),s.prevAll(".js-model-value").addClass("is-hidden"),s.removeClass("is-hidden").addClass("edit").focus(),t.addClass("is-hidden")},getModalContent:function(){return{name:gettext("confirm"),title:gettext("Publish this program?"),body:gettext("After you publish this program, you cannot add or remove course codes or remove course runs."),cta:{cancel:gettext("Cancel"),confirm:gettext("Publish")}}},publishProgram:function(){var e={status:"active"};this.model.set(e,{silent:!0}),this.model.on("sync",this.render,this),this.model.patch(e)},setAvailableCourseRuns:function(){var e,t=this.courseRuns.toJSON(),n=this.model.get("course_codes"),i=t;n.length&&(e=s.pluck(n,"run_modes"),e=s.flatten(e)),i=s.reject(t,function(t){var n=s.findWhere(e,{course_key:t.id,start_date:t.start});return!s.isUndefined(n)}),this.courseRuns.set(i)},validateMarketingSlug:function(){var e=!1,t={},n={};return this.model.get("marketing_slug").length>0?e=!0:(t=this.$el.find("#program-marketing-slug"),n=t.siblings(".field-message"),t.addClass("has-error"),n.addClass("has-error"),n.find(".field-message-content").text(gettext("Marketing Slug is required."))),e}})}),define("js/programs/router",["backbone","js/programs/views/program_creator_view","js/programs/views/program_details_view","js/programs/models/program_model"],function(e,t,n,s){"use strict";return e.Router.extend({root:"/program/",routes:{"new":"programCreator",":id":"programDetails"},initialize:function(e){this.homeUrl=e.homeUrl},goHome:function(){window.location.href=this.homeUrl},loadProgramDetails:function(){this.programDetailsView=new n({model:this.programModel})},programCreator:function(){this.programCreatorView&&this.programCreatorView.destroy(),this.programCreatorView=new t({router:this})},programDetails:function(e){this.programModel=new s({id:e}),this.programModel.on("sync",this.loadProgramDetails,this),this.programModel.fetch()},start:function(){return e.history.started||e.history.start({pushState:!0,root:this.root}),this}})}),function(){"use strict";define("js/programs/views/program_admin_app_view",["backbone","js/programs/router","js/programs/utils/api_config"],function(e,t,n){return e.View.extend({el:".js-program-admin",events:{"click .js-app-click":"navigate"},initialize:function(){n.set({lmsBaseUrl:this.$el.data("lms-base-url"),programsApiUrl:this.$el.data("programs-api-url"),authUrl:this.$el.data("auth-url"),username:this.$el.data("username")}),this.app=new t({homeUrl:this.$el.data("home-url")}),this.app.start()},navigate:function(t){var n=$(t.target).attr("href").replace(this.app.root,"");return t.ctrlKey||t.shiftKey||t.metaKey||2===t.which?!0:(t.preventDefault(),void(n===e.history.getFragment()&&""===n?this.app.index():this.app.navigate(n,{trigger:!0})))}})})}(),function(){"use strict";require(["js/programs/views/program_admin_app_view"],function(e){return new e})}(),define("js/programs/program_admin_app",function(){});